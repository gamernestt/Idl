(function() {
  const targetURL = "https://80-firebase-andrpid-2-1748354430437.cluster-w5vd22whf5gmav2vgkomwtc4go.cloudworkstations.dev/vnc.html?autoconnect=true&resize=remote";
  const key = "__autoBackEnabled";

  function startLoop() {
    if (window.__autoBackInterval) {
      console.log("[AutoBack] Loop already running.");
      return;
    }

    console.log("[AutoBack] Starting 15s back loop...");
    window.__autoBackInterval = setInterval(() => {
      try {
        if (location.href === targetURL && history.length > 1) {
          console.log("[AutoBack] Navigating back...");
          history.back();
        } else {
          console.warn("[AutoBack] URL doesn't match or no history.");
        }
      } catch (e) {
        console.error("[AutoBack Error]", e);
      }
    }, 15000);
  }

  function stopLoop() {
    clearInterval(window.__autoBackInterval);
    delete window.__autoBackInterval;
    localStorage.removeItem(key);
    console.log("[AutoBack] Loop stopped.");
  }

  // Auto-start if enabled and on the right URL
  if (location.href === targetURL) {
    if (localStorage.getItem(key) === "true") {
      startLoop();
    } else {
      // Ask the user once
      const confirmed = confirm("Start auto-back every 15 seconds on this page?");
      if (confirmed) {
        localStorage.setItem(key, "true");
        startLoop();
      }
    }
  } else {
    console.warn("[AutoBack] Not on the target URL. Nothing started.");
  }

  // Expose stop function to console
  window.stopAutoBack = stopLoop;
})();
